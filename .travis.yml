language: objective-c
osx_image: xcode10.2
env:
  global:
  - LC_CTYPE=en_US.UTF-8
  - LANG=en_US.UTF-8
  - GOOGLE_APPLICATION_CREDENTIALS=./travis/ably-cocoa-8dc6f6f2209d.json
matrix:
  include:
    - env: NAME="ably-iOS" PLATFORM="iOS" LANE=test_iOS12
    - env: NAME="ably-iOS" PLATFORM="iOS" LANE=test_iOS11
    - env: NAME="ably-tvOS" PLATFORM="tvOS" LANE=test_tvOS12
    - env: NAME="ably-macOS" PLATFORM="macOS" LANE=test_macOS
    - env: NAME="ably-iOS-soak-test" PLATFORM="iOS" LANE=soaktest
install:
  # Carthage
  - carthage update --platform $PLATFORM --cache-builds
  - bundle install
before_script:
  - xcrun simctl erase all
  # Decrypt every .enc file in travis/
  # Those were encrypted with `travis encrypt-file`
  - for file in $(ls ./travis/*.enc); do openssl aes-256-cbc -K $encrypted_b41778345f70_key -iv $encrypted_b41778345f70_iv -in $file -out $(echo $file | sed 's/\.enc$//') -d; done
script:
script:
  - sudo mkdir '/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS 9.3.simruntime/Contents/Resources/RuntimeRoot/usr/lib/swift'
  - export ABLY_ENV="sandbox"
  - fastlane $LANE
  - if [ ${RUN_EXAMPLES} == "true" ]; then bash ./Scripts/run_examples_tests.sh; fi
after_success:
  - sleep 5
cache:
  directories:
  - Carthage